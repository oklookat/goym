# goym

API десктопного приложения Яндекс.Музыки для Go.

Брал методы [из этой документации](https://www.cherkashin.dev/yandex-music-open-api).
И [еще тут](https://github.com/MarshalX/yandex-music-api) можно полезные вещи найти.

Особенности:
- Убрал некоторые лишние (имхо) поля, по типу баннеров, и прочих вещей.
- На том сайте, по состоянию на 02.01.23 некоторые ответы уже не те, я их подправил.
- Реализованы не все методы
- Тесты не писал, детального ничего не проверял. Могут быть ошибки. Еще API может перестать работать, если сменятся client_id, client_secret у приложения ЯМ для Windows.
- Вход по методу "[Пользователь вводит код на Яндекс.OAuth](https://yandex.ru/dev/id/doc/dg/oauth/reference/simple-input-client.html)".
- Реализовано (но не протестировано) [обновление токенов](https://yandex.ru/dev/id/doc/dg/oauth/reference/refresh-client.html).

Требования:
- Go 1.18+


# Гайд

Из пакета [auth](auth) вызываете метод New(), передаете контекст с отменой (желательно), логин или почту,
и функцию, в которой вам надо будет направить пользователя по url из параметра url, чтобы он ввел там код из параметра code. Пользователю надо сделать это в течение пяти минут, потом токены истекут, а вам вернется ошибка.

Каждые 7 секунд горутина будет отправлять запрос, проверяя, ввел ли пользователь код. До первой ошибки, или успеха. Поэтому важно передать контекст с отменой, чтобы вы смогли отменить бесконечный цикл, в случае чего.

После того, как пользователь введет код, при следующем запросе к api, функция вернет токены или ошибку.

Чтоб не авторизироваться по 100 раз, полученные токены сохраните куда-нибудь.

Отдайте токены функции [New() в пакете main](./main.go), в ответ вернется клиент для запросов к API.

# Обновление токенов
В токенах есть поле "RefreshAfter", которое обозначает время, когда эти токены надо обновить. Если токены получены только что, то это время будет +- 3 месяца. У токенов есть метод Refresh(), который и будет выполнять обновление. Если токены обновятся, то **метод вернет вам новые токены, а старые перестанут действовать**. **Если обновление токенов не требуется, то вернется просто nil**. В общем, вызывайте время от времени Refresh(), получайте новые токены, и перезаписывайте старые.
